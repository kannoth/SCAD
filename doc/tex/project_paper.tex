\documentclass[adraft]{eptcs}
\usepackage[utf8]{inputenc}

\usepackage[toc,page]{appendix}

% Defines \FloatBarrier
% The "section" parameter makes floats stay in the section they are defined in.
\usepackage[section]{placeins}

\usepackage{graphicx}
\graphicspath{ {figures/} }
%\usepackage{listings}
\usepackage{eslistings}
\usepackage{parcolumns}
\usepackage{amsmath}
\usepackage{url}
\usepackage{breakurl}
\usepackage{todonotes}

\usepackage{tikz-timing}

\renewcommand{\abstractname}{Abstract}

% Define Language
\lstdefinelanguage{SCAD}
{
  % list of keywords
  morekeywords={
    immediate,
    move,
    branch,
    jump
  },
  sensitive=false, % keywords are not case-sensitive
  morecomment=[l]{//}, % l is for line comment
  morecomment=[s]{/*}{*/}, % s is for start and end delimiter
  morestring=[b]" % defines that strings are enclosed in double quotes
}

%TODO: center listings
\lstset{language=SCAD,frame=L,style=ESStyle,tabsize=2,basicstyle=\small\ttfamily}
%\lstset{language=C,frame=L,style=ESStyle,tabsize=2,basicstyle=\small\ttfamily}
%\lstset{language=C,frame=L,basicstyle=\small\ttfamily,tabsize=2}
\lstset{numbersep=10pt}
\lstset{xleftmargin=5.0ex}
\lstset{numbers=left}
% Captions to the bottom
\lstset{captionpos=b}
\lstset{breaklines=false}

% Not used and has a tendency to break code.
\lstset{mathescape=false}

\newcommand{\ie}{i.~e.}
\newcommand{\Ie}{I.~e.}
\newcommand{\eg}{e.g.}
\newcommand{\Eg}{E.~g.}


\begin{document}
\begin{titlepage}
	\title{}
	\centering
	\includegraphics[width=0.75\textwidth]{TUKL_LOGO_FELD_LINKS_RGB}\par\vspace{1cm}
	{\Large Department of Computer Science \\ \it Embedded Systems Group \par}
	\vspace{1cm}
	{\Large Master Project\par}
	\vspace{1.5cm}
	{\huge\bfseries Implementation of SCAD processor \par}
	\vspace{2cm}
	{\Large Julius Roob \\ Mahircan G{\"u}l \\ Maisum Haider \\ Subash Kannoth \par}
	\vfill
	supervised by\par
	\Large{Tripti Jain}
	\vfill
% Bottom of the page
	{\large \today\par}
\end{titlepage}

	%\maketitle \newpage
	\input{abstract} \newpage
	\tableofcontents \newpage
	\listoftodos \newpage
	
	\input{instruction_set_architecture}
	
	\section{Move Instruction Bus}
		\subsection{2-Phase Commit}
			To take into account both stalls of source and destination functional units, the control unit sends move instructions in two phases, both of which are indicated by a rising edge of the "valid" flag\todo{Either the text, the diagram and/or the implementation need to be adapted (not in sync).}.
			First, with phase low, the functional units only check whether there is space in the corresponding input and output buffers.
			When stalls are asserted, the control unit waits some time until retrying.
			When no functional unit stalls, the phase being high signals a "write".
			
			\begin{figure}
				\begin{center}
					\begin{tikztimingtable}
						src & Z18D{source address}Z \\
						dest & Z18D{destination address}Z \\
						phase & LLLLLLLLLLLLLLHHHHLL \\
						valid & LLLHHHHHHHHHHHHHHHLL \\
						src\_stalled & LLLLLLLLLLLLLLLLLLLL \\
						dest\_stalled & LLLLLHHHHHLLLLLLLLLL \\
					\end{tikztimingtable}
					\caption{2-Phase Commit on Move Instruction Bus with Destination Stalling}
				\end{center}
			\end{figure}

	\section{Control Unit and Data Network}
		\todo{remove this section? -julius}
		To keep the MIB simple, we will have the control unit send immediate values, and receive branch conditions through the data network.
		While broadcasting immediate values through either the MIB or a separate bus may be the faster alternative, having the control unit send them through the data network keeps the architecture cleaner\todo{better formulation please}.

	\section{Data Trasport Network - DTN}
		\input{dtn}

		\subsection{Bitonic Network}
			\input{bitonic}
			
		\FloatBarrier
		\subsection{Benes Network}
			\input{benes}

	\section{Future Work}
		Having duplication as a seperate functional unit may cause it to be a significant bottleneck.
		One feasible solution to this is the extension of the move instruction by an additional "non-destructive" move, where data sent is kept in the output buffer of the sender.
		
		\todo[inline]{at least two more ideas}

	\newpage
	\section{Bibliography}
		%\nocite{*}
		\bibliographystyle{eptcs}
		\bibliography{references}
	\newpage
	
	\begin{appendices}
		\newpage
		\section{Memory Access and Branch}
			\label{app:simple}
			Basic example for memory access and branching:
			\lstinputlisting{assembler/simple.asm}
		
		\newpage
		\section{Fibonacci}
			\label{app:fib}
			\lstinputlisting{assembler/fibonacci.asm}
	\end{appendices}
	
\end{document}

