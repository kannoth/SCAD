To take into account both stalls of source and destination functional units, the control unit sends move instructions in two phases, both of which are indicated by a rising edge of the "valid" flag. First, with phase low, the functional units only check whether there is space in the corresponding input and output buffers.
When stalls are asserted, the control unit waits until the signals are dropped.When no functional unit of the current instruction stalls, the phase being high signals a "write".
\begin{figure}[!h]
\begin{center}
\begin{tikztimingtable}
src & Z18D{source address}Z \\
dest & Z18D{destination address}Z \\
phase & LLLLLLLLLLLLLLHHHHLL \\
valid & LLLHHHHHHHLLHHHHHHLL \\
src\_stalled & LLLLLLLLLLLLLLLLLLLL \\
dest\_stalled & LLLLLHHHHHLLLLLLLLLL \\
\end{tikztimingtable}
\caption{2-Phase Commit on Move Instruction Bus with Destination Stalling}
\end{center}
\end{figure}
